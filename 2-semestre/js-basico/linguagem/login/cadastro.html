<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>Title</title>
        <link href="css/style.css" rel="stylesheet" />
        <script>
            function validadeCadastro() {
                const user = document.getElementById("user").value
                const pwd = document.getElementById("pwd").value
                const confPwd = document.getElementById("confPwd").value

                if (!user) alert("Preencha o campo usuário!")
                else if (!pwd) alert("Preencha o campo senha!")
                else if (!confPwd) alert("Preencha o campo confirmação de senha!")
                else if (pwd !== confPwd) alert("As senhas não conferem!")
                else (recordNewUser(user))
            }

            function recordNewUser(user) {
                fetch("json/users.json")
                    .then((response) => response.json())
                    .then((data) => checkUserCadastro(data, user))
            }

            function checkUserCadastro(content, user) {
                if (content.find((usuario) => usuario.user === user)) alert("Usuário já cadastrado!")
                else document.getElementsByTagName("form")[0].submit()
            }
        </script>
    </head>

    <body>
        <h1>Cadastro</h1>
        <form action="php/server.php" method="get">
            <label><input id="user" name="user" placeholder="Usuário" type="text" /></label>
            <label><input id="pwd" name="pwd" placeholder="Senha" type="password" /></label>
            <label><input id="confPwd" placeholder="Confirmar Senha" type="password" /></label>
            <input onclick="validadeCadastro()" type="button" value="Cadastrar" />
        </form>

        <p>Já é cadastrado? <a href="login.html">Clique aqui!</a></p>
    </body>
</html>
